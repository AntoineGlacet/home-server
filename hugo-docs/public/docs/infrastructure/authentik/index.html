<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Authentik - SSO & Authentication | Home Server Documentation</title><meta name=description content="Single Sign-On and forward authentication for all web services"><meta property="og:url" content="https://docs.antoineglacet.com/docs/infrastructure/authentik/"><meta property="og:site_name" content="Home Server Documentation"><meta property="og:title" content="Authentik - SSO & Authentication"><meta property="og:description" content="Single Sign-On and forward authentication for all web services"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Authentik - SSO & Authentication"><meta itemprop=description content="Single Sign-On and forward authentication for all web services"><meta itemprop=wordCount content="1541"><meta name=twitter:card content="summary"><meta name=twitter:title content="Authentik - SSO & Authentication"><meta name=twitter:description content="Single Sign-On and forward authentication for all web services"><link rel=preload href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css as=style integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><link href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css rel=stylesheet integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Home Server Documentation</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=https://homepage.antoineglacet.com target=_blank rel=noopener><span>Homepage</span></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main data-bs-spy=scroll data-bs-target=.td-toc data-bs-root-margin="0px 0px -10%"><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><script>$(function(){$("#td-section-nav a").removeClass("active"),$("#td-section-nav #m-docsinfrastructureauthentik").addClass("active"),$("#td-section-nav #m-docsinfrastructureauthentik-li span").addClass("td-sidebar-nav-active-item"),$("#td-section-nav #m-docsinfrastructureauthentik").parents("li").addClass("active-path"),$("#td-section-nav li.active-path").addClass("show"),$("#td-section-nav li.active-path").children("input").prop("checked",!0),$("#td-section-nav #m-docsinfrastructureauthentik-li").siblings("li").addClass("show"),$("#td-section-nav #m-docsinfrastructureauthentik-li").children("ul").children("li").addClass("show"),$("#td-sidebar-menu").toggleClass("d-none")})</script><div id=td-sidebar-menu class="td-sidebar__inner d-none"><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-li><a href=/docs/ title=Documentation class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Docs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsoperations-li><input type=checkbox id=m-docsoperations-check>
<label for=m-docsoperations-check><a href=/docs/operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsoperations><span>Operations</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsoperating-li><input type=checkbox id=m-docsoperationsoperating-check>
<label for=m-docsoperationsoperating-check><a href=/docs/operations/operating/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsoperating><span>Operating Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsquick_start-li><input type=checkbox id=m-docsoperationsquick_start-check>
<label for=m-docsoperationsquick_start-check><a href=/docs/operations/quick_start/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquick_start><span>Quick Start: Fix SSH Lag & LAN Latency</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance-tuning-li><input type=checkbox id=m-docsoperationsperformance-tuning-check>
<label for=m-docsoperationsperformance-tuning-check><a href=/docs/operations/performance-tuning/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance-tuning><span>Performance Tuning Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance_optimization-li><input type=checkbox id=m-docsoperationsperformance_optimization-check>
<label for=m-docsoperationsperformance_optimization-check><a href=/docs/operations/performance_optimization/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance_optimization><span>Performance Optimization Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsinfrastructure-li><input type=checkbox id=m-docsinfrastructure-check>
<label for=m-docsinfrastructure-check><a href=/docs/infrastructure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsinfrastructure><span>Infrastructure</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructuretraefik-li><input type=checkbox id=m-docsinfrastructuretraefik-check>
<label for=m-docsinfrastructuretraefik-check><a href=/docs/infrastructure/traefik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructuretraefik><span>Traefik - Reverse Proxy & TLS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructureauthentik-li><input type=checkbox id=m-docsinfrastructureauthentik-check>
<label for=m-docsinfrastructureauthentik-check><a href=/docs/infrastructure/authentik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructureauthentik><span>Authentik - SSO & Authentication</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsmonitoring-li><input type=checkbox id=m-docsmonitoring-check>
<label for=m-docsmonitoring-check><a href=/docs/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonitoring><span>Monitoring</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringmonitoring-li><input type=checkbox id=m-docsmonitoringmonitoring-check>
<label for=m-docsmonitoringmonitoring-check><a href=/docs/monitoring/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringmonitoring><span>Monitoring & Observability</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringgrafana-setup-li><input type=checkbox id=m-docsmonitoringgrafana-setup-check>
<label for=m-docsmonitoringgrafana-setup-check><a href=/docs/monitoring/grafana-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringgrafana-setup><span>Grafana Setup Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstroubleshooting-li><input type=checkbox id=m-docstroubleshooting-check>
<label for=m-docstroubleshooting-check><a href=/docs/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docstroubleshooting><span>Troubleshooting</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstroubleshootingtroubleshooting-li><input type=checkbox id=m-docstroubleshootingtroubleshooting-check>
<label for=m-docstroubleshootingtroubleshooting-check><a href=/docs/troubleshooting/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstroubleshootingtroubleshooting><span>Troubleshooting Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdeployment-li><input type=checkbox id=m-docsdeployment-check>
<label for=m-docsdeployment-check><a href=/docs/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdeployment><span>Deployment</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_checklist-li><input type=checkbox id=m-docsdeploymentdeployment_checklist-check>
<label for=m-docsdeploymentdeployment_checklist-check><a href=/docs/deployment/deployment_checklist/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_checklist><span>Deployment Checklist - Infrastructure Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentpost-commit-steps-li><input type=checkbox id=m-docsdeploymentpost-commit-steps-check>
<label for=m-docsdeploymentpost-commit-steps-check><a href=/docs/deployment/post-commit-steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentpost-commit-steps><span>Post-Commit Setup Steps</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_notes-li><input type=checkbox id=m-docsdeploymentdeployment_notes-check>
<label for=m-docsdeploymentdeployment_notes-check><a href=/docs/deployment/deployment_notes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_notes><span>Deployment Notes - 2026-01-16</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymenthugo-site-setup-li><input type=checkbox id=m-docsdeploymenthugo-site-setup-check>
<label for=m-docsdeploymenthugo-site-setup-check><a href=/docs/deployment/hugo-site-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymenthugo-site-setup><span>Hugo Documentation Site - Setup Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentalerting_migration-li><input type=checkbox id=m-docsdeploymentalerting_migration-check>
<label for=m-docsdeploymentalerting_migration-check><a href=/docs/deployment/alerting_migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentalerting_migration><span>Alerting Migration to Grafana</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentreadme-li><input type=checkbox id=m-docsdeploymentreadme-check>
<label for=m-docsdeploymentreadme-check><a href=/docs/deployment/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentreadme><span></span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsplanning-li><input type=checkbox id=m-docsplanning-check>
<label for=m-docsplanning-check><a href=/docs/planning/ title="Planning & Status" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsplanning><span>Planning</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningimplementation_status-li><input type=checkbox id=m-docsplanningimplementation_status-check>
<label for=m-docsplanningimplementation_status-check><a href=/docs/planning/implementation_status/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningimplementation_status><span>Implementation Status - Home Server Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningnext_steps-li><input type=checkbox id=m-docsplanningnext_steps-check>
<label for=m-docsplanningnext_steps-check><a href=/docs/planning/next_steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningnext_steps><span>Next Steps - Alerting Migration Testing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningsecurity_remediation-li><input type=checkbox id=m-docsplanningsecurity_remediation-check>
<label for=m-docsplanningsecurity_remediation-check><a href=/docs/planning/security_remediation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningsecurity_remediation><span>Security Remediation: Discord Webhook Leak</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningreadme-li><input type=checkbox id=m-docsplanningreadme-check>
<label for=m-docsplanningreadme-check><a href=/docs/planning/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningreadme><span></span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc data-proofer-ignore><div class=td-toc-title><span class=td-toc-title__text>On this page</span>
<a class=td-toc-title__link title="Top of page" href=#></a></div><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#overview>Overview</a><ul><li><a href=#what-is-authentik>What is Authentik?</a></li><li><a href=#access-points>Access Points</a></li><li><a href=#key-features>Key Features</a></li></ul></li><li><a href=#architecture>Architecture</a><ul><li><a href=#components>Components</a></li><li><a href=#container-details>Container Details</a></li><li><a href=#database-schema>Database Schema</a></li></ul></li><li><a href=#how-forward-auth-works>How Forward Auth Works</a><ul><li><a href=#request-flow>Request Flow</a></li><li><a href=#middleware-configuration>Middleware Configuration</a></li><li><a href=#applying-to-services>Applying to Services</a></li></ul></li><li><a href=#protected-services>Protected Services</a><ul><li><a href=#services-with-authentik-auth>Services with Authentik Auth</a></li><li><a href=#services-without-authentik>Services WITHOUT Authentik</a></li><li><a href=#why-some-services-skip-authentik>Why Some Services Skip Authentik</a></li></ul></li><li><a href=#user-management>User Management</a><ul><li><a href=#initial-setup>Initial Setup</a></li><li><a href=#creating-users>Creating Users</a></li><li><a href=#managing-groups>Managing Groups</a></li><li><a href=#password-policies>Password Policies</a></li><li><a href=#mfa-multi-factor-authentication>MFA (Multi-Factor Authentication)</a></li></ul></li><li><a href=#grafana-oauth-integration>Grafana OAuth Integration</a><ul><li><a href=#setup-in-authentik>Setup in Authentik</a></li><li><a href=#configure-grafana>Configure Grafana</a></li><li><a href=#role-mapping>Role Mapping</a></li></ul></li><li><a href=#monitoring>Monitoring</a><ul><li><a href=#health-checks>Health Checks</a></li><li><a href=#logs>Logs</a></li><li><a href=#metrics>Metrics</a></li><li><a href=#database-health>Database Health</a></li><li><a href=#redis-health>Redis Health</a></li></ul></li><li><a href=#troubleshooting>Troubleshooting</a><ul><li><a href=#login-issues>Login Issues</a></li><li><a href=#service-access-issues>Service Access Issues</a></li><li><a href=#database-issues>Database Issues</a></li><li><a href=#performance-issues>Performance Issues</a></li><li><a href=#recovery>Recovery</a></li><li><a href=#debugging-oauth>Debugging OAuth</a></li><li><a href=#common-mistakes>Common Mistakes</a></li><li><a href=#debug-mode>Debug Mode</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Docs</a></li><li class=breadcrumb-item><a href=/docs/infrastructure/>Infrastructure</a></li><li class="breadcrumb-item active" aria-current=page>Authentik - SSO & Authentication</li></ol></nav><div class=td-content><h1>Authentik - SSO & Authentication</h1><div class=lead>Single Sign-On and forward authentication for all web services</div><header class=article-meta></header><p>Authentik provides Single Sign-On (SSO) and forward authentication for all web services.</p><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=#overview>Overview</a></li><li><a href=#architecture>Architecture</a></li><li><a href=#how-forward-auth-works>How Forward Auth Works</a></li><li><a href=#protected-services>Protected Services</a></li><li><a href=#user-management>User Management</a></li><li><a href=#grafana-oauth-integration>Grafana OAuth Integration</a></li><li><a href=#monitoring>Monitoring</a></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul><h2 id=overview>Overview</h2><h3 id=what-is-authentik>What is Authentik?</h3><p>Authentik is an identity provider (IdP) that handles:</p><ul><li>User authentication (login)</li><li>Single Sign-On across services</li><li>OAuth2/OIDC provider</li><li>Forward authentication for Traefik</li><li>User and group management</li><li>Multi-factor authentication (MFA)</li></ul><h3 id=access-points>Access Points</h3><ul><li><strong>Admin Interface</strong>: <a href=https://authentik.antoineglacet.com>https://authentik.antoineglacet.com</a></li><li><strong>User Portal</strong>: <a href=https://authentik.antoineglacet.com/if/user/>https://authentik.antoineglacet.com/if/user/</a></li><li><strong>API</strong>: <a href=https://authentik.antoineglacet.com/api/v3/>https://authentik.antoineglacet.com/api/v3/</a></li></ul><h3 id=key-features>Key Features</h3><ul><li><strong>Forward Auth</strong>: Protects services via Traefik middleware</li><li><strong>OAuth2/OIDC</strong>: Integrates with apps like Grafana</li><li><strong>User Management</strong>: Create users, groups, and permissions</li><li><strong>Flows</strong>: Customizable authentication/authorization workflows</li><li><strong>Providers</strong>: Configure per-application access</li></ul><h2 id=architecture>Architecture</h2><h3 id=components>Components</h3><pre tabindex=0><code>authentik-server  → Web UI, OAuth provider, forward auth endpoint
authentik-worker  → Background tasks (email, scheduled jobs)
authentik-redis   → Session storage, cache
postgres          → User database, configurations, policies
</code></pre><h3 id=container-details>Container Details</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View running Authentik containers</span>
</span></span><span style=display:flex><span>docker compose ps <span style=color:#000;font-weight:700>|</span> grep authentik
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check resource usage</span>
</span></span><span style=display:flex><span>docker stats authentik-server authentik-worker authentik-redis
</span></span></code></pre></div><h3 id=database-schema>Database Schema</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Connect to database</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U authentik -d authentik
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># List tables</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>\d</span>t
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View users</span>
</span></span><span style=display:flex><span>SELECT username, email, is_active FROM auth_user<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><h2 id=how-forward-auth-works>How Forward Auth Works</h2><h3 id=request-flow>Request Flow</h3><pre tabindex=0><code>1. User requests: https://grafana.antoineglacet.com
2. Traefik receives request
3. Traefik calls Authentik: GET http://authentik-server:9000/outpost.goauthentik.io/auth/traefik
4. Authentik checks session:
   - Valid session → returns 200 + user headers
   - No session → returns 302 redirect to login
5. If 200: Traefik forwards request to Grafana with headers
   If 302: User sent to Authentik login page
6. After login, Authentik redirects back to original URL
</code></pre><h3 id=middleware-configuration>Middleware Configuration</h3><p>Defined in <code>authentik-server</code> labels in <code>docker-compose.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># ForwardAuth middleware</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;traefik.http.middlewares.authentik.forwardauth.address=http://authentik-server:9000/outpost.goauthentik.io/auth/traefik&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;traefik.http.middlewares.authentik.forwardauth.trustForwardHeader=true&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;traefik.http.middlewares.authentik.forwardauth.authResponseHeaders=authorization,X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid,X-authentik-jwt,X-authentik-meta-jwks,X-authentik-meta-outpost,X-authentik-meta-provider,X-authentik-meta-app,X-authentik-meta-version&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=applying-to-services>Applying to Services</h3><p>Add this label to any service in <code>docker-compose.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;traefik.http.routers.SERVICE.middlewares=authentik@docker&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=protected-services>Protected Services</h2><h3 id=services-with-authentik-auth>Services with Authentik Auth</h3><p>These services require Authentik login:</p><ul><li><strong>Dashboards</strong>: Grafana, Homepage, Glances</li><li><strong>Management</strong>: Traefik Dashboard, AdGuard Home</li><li><strong>Media</strong>: Sonarr, Radarr, Bazarr, Prowlarr, Transmission, Calibre Web</li><li><strong>Utilities</strong>: Zigbee2MQTT, Duplicati, Syncthing, SiYuan</li></ul><h3 id=services-without-authentik>Services WITHOUT Authentik</h3><p>These services use their own authentication:</p><ul><li><strong>Plex</strong>: Native authentication (Authentik breaks many Plex clients)</li><li><strong>Home Assistant</strong>: Built-in user management</li><li><strong>Prometheus</strong>: Internal only (no external exposure)</li></ul><h3 id=why-some-services-skip-authentik>Why Some Services Skip Authentik</h3><p><strong>Plex:</strong></p><ul><li>Mobile apps don&rsquo;t support forward auth</li><li>Smart TVs/game consoles can&rsquo;t handle redirects</li><li>Plex has robust built-in authentication</li></ul><p><strong>Home Assistant:</strong></p><ul><li>Needs direct access for automations</li><li>Mobile app requires native auth</li><li>Companion app integration</li></ul><h2 id=user-management>User Management</h2><h3 id=initial-setup>Initial Setup</h3><p>First user created becomes admin:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># After first startup, visit:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://authentik.antoineglacet.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create admin account:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Username: admin</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Email: your@email.com</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Password: (strong password)</span>
</span></span></code></pre></div><h3 id=creating-users>Creating Users</h3><ol><li><p><strong>Via Admin UI:</strong></p><ul><li>Navigate to: Directory → Users</li><li>Click: Create</li><li>Fill in: Username, Name, Email</li><li>Set: Active, groups</li><li>Optional: Set password or send invitation</li></ul></li><li><p><strong>Bulk Import:</strong></p><ul><li>Directory → Users → Import</li><li>Upload CSV with: username, email, name</li></ul></li></ol><h3 id=managing-groups>Managing Groups</h3><p>Groups control access to applications:</p><pre tabindex=0><code>1. Directory → Groups → Create
2. Name: &#34;Media Admins&#34;
3. Add users to group
4. Assign group to applications via Policies
</code></pre><h3 id=password-policies>Password Policies</h3><p>Configure in:</p><ul><li>System → Policies → Create → Password Policy</li><li>Set: Min length, complexity, expiry</li></ul><h3 id=mfa-multi-factor-authentication>MFA (Multi-Factor Authentication)</h3><p>Enable for users:</p><ol><li><p><strong>As admin:</strong></p><ul><li>Directory → Users → Select user → Enroll</li><li>Choose: TOTP, WebAuthn, etc.</li></ul></li><li><p><strong>As user:</strong></p><ul><li>User settings → MFA Devices → Enroll</li></ul></li></ol><h2 id=grafana-oauth-integration>Grafana OAuth Integration</h2><p>Grafana uses Authentik as OAuth2 provider for seamless SSO.</p><h3 id=setup-in-authentik>Setup in Authentik</h3><ol><li><p><strong>Create Provider:</strong></p><ul><li>Applications → Providers → Create</li><li>Type: OAuth2/OpenID Provider</li><li>Name: <code>grafana-oauth</code></li><li>Client Type: Confidential</li><li>Redirect URIs: <code>https://grafana.antoineglacet.com/login/generic_oauth</code></li><li>Scopes: <code>openid profile email</code></li><li>Save and note: Client ID, Client Secret</li></ul></li><li><p><strong>Create Application:</strong></p><ul><li>Applications → Applications → Create</li><li>Name: <code>Grafana</code></li><li>Slug: <code>grafana</code></li><li>Provider: <code>grafana-oauth</code></li><li>Launch URL: <code>https://grafana.antoineglacet.com</code></li></ul></li></ol><h3 id=configure-grafana>Configure Grafana</h3><p>Add to <code>.env</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>Authentik
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_CLIENT_ID</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;client-id-from-authentik&gt;
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;client-secret-from-authentik&gt;
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_SCOPES</span><span style=color:#ce5c00;font-weight:700>=</span>openid profile email
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_AUTH_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://authentik.antoineglacet.com/application/o/authorize/
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_TOKEN_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://authentik.antoineglacet.com/application/o/token/
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_API_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://authentik.antoineglacet.com/application/o/userinfo/
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_SIGNOUT_REDIRECT_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://authentik.antoineglacet.com/application/o/grafana/end-session/
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_OAUTH_AUTO_LOGIN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>  <span style=color:#8f5902;font-style:italic># Skip Grafana login screen</span>
</span></span><span style=display:flex><span><span style=color:#000>GF_SERVER_ROOT_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://grafana.antoineglacet.com
</span></span></code></pre></div><p>Restart Grafana:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose restart grafana
</span></span></code></pre></div><h3 id=role-mapping>Role Mapping</h3><p>Map Authentik groups to Grafana roles:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># In .env:</span>
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_ROLE_ATTRIBUTE_PATH</span><span style=color:#ce5c00;font-weight:700>=</span>contains<span style=color:#ce5c00;font-weight:700>(</span>groups<span style=color:#ce5c00;font-weight:700>[</span>*<span style=color:#ce5c00;font-weight:700>]</span>, <span style=color:#4e9a06>&#39;Grafana Admins&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#4e9a06>&#39;Admin&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> contains<span style=color:#ce5c00;font-weight:700>(</span>groups<span style=color:#ce5c00;font-weight:700>[</span>*<span style=color:#ce5c00;font-weight:700>]</span>, <span style=color:#4e9a06>&#39;Grafana Editors&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#4e9a06>&#39;Editor&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#4e9a06>&#39;Viewer&#39;</span>
</span></span></code></pre></div><p>Then in Authentik:</p><ol><li>Create groups: <code>Grafana Admins</code>, <code>Grafana Editors</code></li><li>Assign users to groups</li></ol><h2 id=monitoring>Monitoring</h2><h3 id=health-checks>Health Checks</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check Authentik server is responding</span>
</span></span><span style=display:flex><span>curl -I https://authentik.antoineglacet.com/-/health/live/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check worker is processing tasks</span>
</span></span><span style=display:flex><span>docker compose logs authentik-worker <span style=color:#000;font-weight:700>|</span> grep -i <span style=color:#4e9a06>&#34;processing\|completed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check Redis connection</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli ping
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should return: PONG</span>
</span></span></code></pre></div><h3 id=logs>Logs</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Server logs (auth attempts, errors)</span>
</span></span><span style=display:flex><span>docker compose logs -f authentik-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Worker logs (background tasks)</span>
</span></span><span style=display:flex><span>docker compose logs -f authentik-worker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Filter for errors</span>
</span></span><span style=display:flex><span>docker compose logs authentik-server <span style=color:#000;font-weight:700>|</span> grep -i error
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Filter for failed logins</span>
</span></span><span style=display:flex><span>docker compose logs authentik-server <span style=color:#000;font-weight:700>|</span> grep -i <span style=color:#4e9a06>&#34;failed\|invalid&#34;</span>
</span></span></code></pre></div><h3 id=metrics>Metrics</h3><p>Authentik exposes metrics at:</p><ul><li><a href=https://authentik.antoineglacet.com/metrics>https://authentik.antoineglacet.com/metrics</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View metrics</span>
</span></span><span style=display:flex><span>curl https://authentik.antoineglacet.com/metrics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Scrape with Prometheus (add to prometheus.yml):</span>
</span></span><span style=display:flex><span>scrape_configs:
</span></span><span style=display:flex><span>  - job_name: <span style=color:#4e9a06>&#39;authentik&#39;</span>
</span></span><span style=display:flex><span>    static_configs:
</span></span><span style=display:flex><span>      - targets: <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;authentik-server:9000&#39;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    metrics_path: <span style=color:#4e9a06>&#39;/metrics&#39;</span>
</span></span></code></pre></div><h3 id=database-health>Database Health</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check PostgreSQL is healthy</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres pg_isready -U authentik -d authentik
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View active sessions</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U authentik -d authentik -c <span style=color:#4e9a06>&#34;SELECT COUNT(*) FROM django_session WHERE expire_date &gt; NOW();&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View user count</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U authentik -d authentik -c <span style=color:#4e9a06>&#34;SELECT COUNT(*) FROM authentik_core_user WHERE is_active=true;&#34;</span>
</span></span></code></pre></div><h3 id=redis-health>Redis Health</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check memory usage</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli INFO memory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View active connections</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli CLIENT LIST
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check key count</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli DBSIZE
</span></span></code></pre></div><h2 id=troubleshooting>Troubleshooting</h2><h3 id=login-issues>Login Issues</h3><h4 id=cant-login---invalid-credentials>Can&rsquo;t login - &ldquo;Invalid credentials&rdquo;</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Verify user exists and is active</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U authentik -d authentik -c <span style=color:#4e9a06>&#34;SELECT username, is_active FROM authentik_core_user WHERE username=&#39;admin&#39;;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Reset password via CLI</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-server ak create_admin_group
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Check logs for details</span>
</span></span><span style=display:flex><span>docker compose logs authentik-server <span style=color:#000;font-weight:700>|</span> grep -i <span style=color:#4e9a06>&#34;authentication failed&#34;</span>
</span></span></code></pre></div><h4 id=redirect-loop>Redirect loop</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Clear browser cookies for *.antoineglacet.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Check Grafana ROOT_URL matches Traefik route</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> grafana env <span style=color:#000;font-weight:700>|</span> grep ROOT_URL
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should match: https://grafana.antoineglacet.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Verify OAuth redirect URI in Authentik</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should be: https://grafana.antoineglacet.com/login/generic_oauth</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Check forward auth header trust</span>
</span></span><span style=display:flex><span>docker inspect authentik-server <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;.[0].Config.Labels&#39;</span> <span style=color:#000;font-weight:700>|</span> grep trustForwardHeader
</span></span></code></pre></div><h4 id=session-expires-too-quickly>Session expires too quickly</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Adjust session timeout in Authentik:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># System → Settings → General → Session duration</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Default: 30 days</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Or via environment:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add to docker-compose.yml:</span>
</span></span><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>  - <span style=color:#000>AUTHENTIK_SESSION_LIFETIME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2592000</span>  <span style=color:#8f5902;font-style:italic># 30 days in seconds</span>
</span></span></code></pre></div><h3 id=service-access-issues>Service Access Issues</h3><h4 id=502-bad-gateway>502 Bad Gateway</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check Authentik server is running</span>
</span></span><span style=display:flex><span>docker compose ps authentik-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Check health endpoint</span>
</span></span><span style=display:flex><span>curl -I https://authentik.antoineglacet.com/-/health/live/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Verify PostgreSQL is healthy</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres pg_isready -U authentik
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Check logs</span>
</span></span><span style=display:flex><span>docker compose logs authentik-server --tail<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>50</span>
</span></span></code></pre></div><h4 id=user-cant-access-service-after-login>User can&rsquo;t access service after login</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check user is in allowed group for application</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Authentik Admin → Applications → [App] → Policy Bindings</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Verify user groups</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Directory → Users → [User] → Groups</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Check policy evaluation</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># System → Events → Logs → Filter by user</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Test with admin user</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If admin works, issue is permissions</span>
</span></span></code></pre></div><h3 id=database-issues>Database Issues</h3><h4 id=database-connection-failed>Database connection failed</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check PostgreSQL is running</span>
</span></span><span style=display:flex><span>docker compose ps postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Verify credentials in .env</span>
</span></span><span style=display:flex><span>grep AUTHENTIK_POSTGRESQL .env
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Test connection</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-server python -c <span style=color:#4e9a06>&#34;import os; from django.db import connection; connection.ensure_connection(); print(&#39;Connected&#39;)&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Check postgres logs</span>
</span></span><span style=display:flex><span>docker compose logs postgres
</span></span></code></pre></div><h4 id=migration-errors>Migration errors</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run migrations manually</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-server ak migrate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check migration status</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-server ak showmigrations
</span></span></code></pre></div><h3 id=performance-issues>Performance Issues</h3><h4 id=slow-authentication>Slow authentication</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check Redis latency</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli --latency
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Check PostgreSQL slow queries</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U authentik -d authentik -c <span style=color:#4e9a06>&#34;SELECT * FROM pg_stat_statements ORDER BY total_time DESC LIMIT 10;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Increase worker count</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Edit docker-compose.yml:</span>
</span></span><span style=display:flex><span>command: worker --concurrency <span style=color:#0000cf;font-weight:700>4</span>
</span></span></code></pre></div><h4 id=high-memory-usage>High memory usage</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check memory usage</span>
</span></span><span style=display:flex><span>docker stats authentik-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set memory limit in docker-compose.yml:</span>
</span></span><span style=display:flex><span>deploy:
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>    limits:
</span></span><span style=display:flex><span>      memory: 768M
</span></span></code></pre></div><h3 id=recovery>Recovery</h3><h4 id=locked-out-of-admin-account>Locked out of admin account</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create recovery key</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-server ak create_recovery_key <span style=color:#0000cf;font-weight:700>10</span> akadmin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Output will be a URL like:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://authentik.antoineglacet.com/recovery/use-token/?token=xxxxx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Visit URL to set new password</span>
</span></span></code></pre></div><h4 id=reset-to-defaults>Reset to defaults</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ⚠️ WARNING: This deletes all users, flows, policies!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Stop Authentik</span>
</span></span><span style=display:flex><span>docker compose stop authentik-server authentik-worker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Drop database</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U postgres -c <span style=color:#4e9a06>&#34;DROP DATABASE authentik;&#34;</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> postgres psql -U postgres -c <span style=color:#4e9a06>&#34;CREATE DATABASE authentik OWNER authentik;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Clear Redis</span>
</span></span><span style=display:flex><span>docker compose <span style=color:#204a87>exec</span> authentik-redis redis-cli FLUSHALL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Start and migrate</span>
</span></span><span style=display:flex><span>docker compose start authentik-server authentik-worker
</span></span><span style=display:flex><span>docker compose logs -f authentik-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 5. Create new admin user</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Visit: https://authentik.antoineglacet.com</span>
</span></span></code></pre></div><h3 id=debugging-oauth>Debugging OAuth</h3><h4 id=oauth-login-fails>OAuth login fails</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check redirect URI matches exactly</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Authentik: Applications → Providers → [provider] → Redirect URIs</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should be: https://grafana.antoineglacet.com/login/generic_oauth</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Verify client ID/secret</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check .env matches Authentik provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Test token endpoint</span>
</span></span><span style=display:flex><span>curl -X POST https://authentik.antoineglacet.com/application/o/token/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -d <span style=color:#4e9a06>&#34;grant_type=client_credentials&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -d <span style=color:#4e9a06>&#34;client_id=YOUR_CLIENT_ID&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -d <span style=color:#4e9a06>&#34;client_secret=YOUR_CLIENT_SECRET&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. Check Authentik events</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># System → Events → Logs → Filter by application</span>
</span></span></code></pre></div><h3 id=common-mistakes>Common Mistakes</h3><ol><li><p><strong>Wrong database credentials</strong></p><ul><li>Check <code>.env</code> matches actual database</li></ul></li><li><p><strong>Redis password mismatch</strong></p><ul><li>Ensure <code>AUTHENTIK_REDIS__PASSWORD</code> matches <code>redis-server --requirepass</code></li></ul></li><li><p><strong>Missing network</strong></p><ul><li>Authentik needs <code>homelab</code> and <code>homelab_proxy</code> networks</li></ul></li><li><p><strong>OAuth redirect URI typo</strong></p><ul><li>Must match exactly (including trailing slash)</li></ul></li><li><p><strong>Session timeout too short</strong></p><ul><li>Users logged out frequently → increase session lifetime</li></ul></li></ol><h3 id=debug-mode>Debug Mode</h3><p>Enable for detailed logs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># In docker-compose.yml:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>AUTHENTIK_LOG_LEVEL=debug</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Restart:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose restart authentik-server authentik-worker
</span></span><span style=display:flex><span>docker compose logs -f authentik-server
</span></span></code></pre></div><p><strong>Remember to disable after debugging!</strong></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Homepage aria-label=Homepage><a target=_blank rel=noopener href=https://homepage.antoineglacet.com aria-label=Homepage><i class="fa fa-home"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Antoine Glacet</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.258190f24d50bde9095e369c0cd7315407f95e1da5f39472b3850b40279a9e08.js integrity="sha256-JYGQ8k1QvekJXjacDNcxVAf5Xh2l85Rys4ULQCeangg=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>