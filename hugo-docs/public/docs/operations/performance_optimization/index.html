<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Performance Optimization Guide | Home Server Documentation</title><meta name=description content="System-wide performance improvements for 39 Docker containers"><meta property="og:url" content="https://docs.antoineglacet.com/docs/operations/performance_optimization/"><meta property="og:site_name" content="Home Server Documentation"><meta property="og:title" content="Performance Optimization Guide"><meta property="og:description" content="System-wide performance improvements for 39 Docker containers"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Performance Optimization Guide"><meta itemprop=description content="System-wide performance improvements for 39 Docker containers"><meta itemprop=wordCount content="1376"><meta name=twitter:card content="summary"><meta name=twitter:title content="Performance Optimization Guide"><meta name=twitter:description content="System-wide performance improvements for 39 Docker containers"><link rel=preload href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css as=style integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><link href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css rel=stylesheet integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Home Server Documentation</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=https://homepage.antoineglacet.com target=_blank rel=noopener><span>Homepage</span></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main data-bs-spy=scroll data-bs-target=.td-toc data-bs-root-margin="0px 0px -10%"><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><script>$(function(){$("#td-section-nav a").removeClass("active"),$("#td-section-nav #m-docsoperationsperformance_optimization").addClass("active"),$("#td-section-nav #m-docsoperationsperformance_optimization-li span").addClass("td-sidebar-nav-active-item"),$("#td-section-nav #m-docsoperationsperformance_optimization").parents("li").addClass("active-path"),$("#td-section-nav li.active-path").addClass("show"),$("#td-section-nav li.active-path").children("input").prop("checked",!0),$("#td-section-nav #m-docsoperationsperformance_optimization-li").siblings("li").addClass("show"),$("#td-section-nav #m-docsoperationsperformance_optimization-li").children("ul").children("li").addClass("show"),$("#td-sidebar-menu").toggleClass("d-none")})</script><div id=td-sidebar-menu class="td-sidebar__inner d-none"><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-li><a href=/docs/ title=Documentation class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Docs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsoperations-li><input type=checkbox id=m-docsoperations-check>
<label for=m-docsoperations-check><a href=/docs/operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsoperations><span>Operations</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsoperating-li><input type=checkbox id=m-docsoperationsoperating-check>
<label for=m-docsoperationsoperating-check><a href=/docs/operations/operating/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsoperating><span>Operating Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsquick_start-li><input type=checkbox id=m-docsoperationsquick_start-check>
<label for=m-docsoperationsquick_start-check><a href=/docs/operations/quick_start/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquick_start><span>Quick Start: Fix SSH Lag & LAN Latency</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance-tuning-li><input type=checkbox id=m-docsoperationsperformance-tuning-check>
<label for=m-docsoperationsperformance-tuning-check><a href=/docs/operations/performance-tuning/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance-tuning><span>Performance Tuning Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance_optimization-li><input type=checkbox id=m-docsoperationsperformance_optimization-check>
<label for=m-docsoperationsperformance_optimization-check><a href=/docs/operations/performance_optimization/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance_optimization><span>Performance Optimization Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsinfrastructure-li><input type=checkbox id=m-docsinfrastructure-check>
<label for=m-docsinfrastructure-check><a href=/docs/infrastructure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsinfrastructure><span>Infrastructure</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructuretraefik-li><input type=checkbox id=m-docsinfrastructuretraefik-check>
<label for=m-docsinfrastructuretraefik-check><a href=/docs/infrastructure/traefik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructuretraefik><span>Traefik - Reverse Proxy & TLS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructureauthentik-li><input type=checkbox id=m-docsinfrastructureauthentik-check>
<label for=m-docsinfrastructureauthentik-check><a href=/docs/infrastructure/authentik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructureauthentik><span>Authentik - SSO & Authentication</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsmonitoring-li><input type=checkbox id=m-docsmonitoring-check>
<label for=m-docsmonitoring-check><a href=/docs/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonitoring><span>Monitoring</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringmonitoring-li><input type=checkbox id=m-docsmonitoringmonitoring-check>
<label for=m-docsmonitoringmonitoring-check><a href=/docs/monitoring/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringmonitoring><span>Monitoring & Observability</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringgrafana-setup-li><input type=checkbox id=m-docsmonitoringgrafana-setup-check>
<label for=m-docsmonitoringgrafana-setup-check><a href=/docs/monitoring/grafana-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringgrafana-setup><span>Grafana Setup Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstroubleshooting-li><input type=checkbox id=m-docstroubleshooting-check>
<label for=m-docstroubleshooting-check><a href=/docs/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docstroubleshooting><span>Troubleshooting</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstroubleshootingtroubleshooting-li><input type=checkbox id=m-docstroubleshootingtroubleshooting-check>
<label for=m-docstroubleshootingtroubleshooting-check><a href=/docs/troubleshooting/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstroubleshootingtroubleshooting><span>Troubleshooting Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdeployment-li><input type=checkbox id=m-docsdeployment-check>
<label for=m-docsdeployment-check><a href=/docs/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdeployment><span>Deployment</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_checklist-li><input type=checkbox id=m-docsdeploymentdeployment_checklist-check>
<label for=m-docsdeploymentdeployment_checklist-check><a href=/docs/deployment/deployment_checklist/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_checklist><span>Deployment Checklist - Infrastructure Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentpost-commit-steps-li><input type=checkbox id=m-docsdeploymentpost-commit-steps-check>
<label for=m-docsdeploymentpost-commit-steps-check><a href=/docs/deployment/post-commit-steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentpost-commit-steps><span>Post-Commit Setup Steps</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_notes-li><input type=checkbox id=m-docsdeploymentdeployment_notes-check>
<label for=m-docsdeploymentdeployment_notes-check><a href=/docs/deployment/deployment_notes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_notes><span>Deployment Notes - 2026-01-16</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymenthugo-site-setup-li><input type=checkbox id=m-docsdeploymenthugo-site-setup-check>
<label for=m-docsdeploymenthugo-site-setup-check><a href=/docs/deployment/hugo-site-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymenthugo-site-setup><span>Hugo Documentation Site - Setup Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentalerting_migration-li><input type=checkbox id=m-docsdeploymentalerting_migration-check>
<label for=m-docsdeploymentalerting_migration-check><a href=/docs/deployment/alerting_migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentalerting_migration><span>Alerting Migration to Grafana</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentreadme-li><input type=checkbox id=m-docsdeploymentreadme-check>
<label for=m-docsdeploymentreadme-check><a href=/docs/deployment/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentreadme><span></span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsplanning-li><input type=checkbox id=m-docsplanning-check>
<label for=m-docsplanning-check><a href=/docs/planning/ title="Planning & Status" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsplanning><span>Planning</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningimplementation_status-li><input type=checkbox id=m-docsplanningimplementation_status-check>
<label for=m-docsplanningimplementation_status-check><a href=/docs/planning/implementation_status/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningimplementation_status><span>Implementation Status - Home Server Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningnext_steps-li><input type=checkbox id=m-docsplanningnext_steps-check>
<label for=m-docsplanningnext_steps-check><a href=/docs/planning/next_steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningnext_steps><span>Next Steps - Alerting Migration Testing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningsecurity_remediation-li><input type=checkbox id=m-docsplanningsecurity_remediation-check>
<label for=m-docsplanningsecurity_remediation-check><a href=/docs/planning/security_remediation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningsecurity_remediation><span>Security Remediation: Discord Webhook Leak</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningreadme-li><input type=checkbox id=m-docsplanningreadme-check>
<label for=m-docsplanningreadme-check><a href=/docs/planning/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningreadme><span></span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc data-proofer-ignore><div class=td-toc-title><span class=td-toc-title__text>On this page</span>
<a class=td-toc-title__link title="Top of page" href=#></a></div><nav id=TableOfContents><ul><li><a href=#-problem-identified>ğŸ”´ Problem Identified</a><ul><li><a href=#symptoms>Symptoms</a></li><li><a href=#root-cause-analysis>Root Cause Analysis</a></li><li><a href=#the-real-problem>The Real Problem</a></li><li><a href=#additional-culprit-cpu-governor>Additional Culprit: CPU Governor</a></li></ul></li><li><a href=#-solution-multi-layered-optimization>âœ… Solution: Multi-Layered Optimization</a><ul><li><a href=#why-swappiness60-is-better-for-your-setup>Why Swappiness=60 is Better for Your Setup</a></li><li><a href=#swappiness-values-explained>Swappiness Values Explained</a></li></ul></li><li><a href=#-optimizations-applied>ğŸ¯ Optimizations Applied</a><ul><li><a href=#tier-1-immediate-impact-fixes-ssh-lag>Tier 1: Immediate Impact (Fixes SSH Lag)</a></li><li><a href=#tier-2-hardware-optimization>Tier 2: Hardware Optimization</a></li><li><a href=#tier-3-additional-improvements>Tier 3: Additional Improvements</a></li></ul></li><li><a href=#-how-to-apply>ğŸ“‹ How to Apply</a><ul><li><a href=#quick-start>Quick Start</a></li><li><a href=#what-the-script-does>What the Script Does</a></li><li><a href=#safety-features>Safety Features</a></li></ul></li><li><a href=#-rollback-instructions>ğŸ”„ Rollback Instructions</a></li><li><a href=#-monitoring-your-system>ğŸ“Š Monitoring Your System</a><ul><li><a href=#before-optimization-metrics>Before Optimization Metrics</a></li><li><a href=#monitor-after-optimization>Monitor After Optimization</a></li><li><a href=#expected-improvements>Expected Improvements</a></li></ul></li><li><a href=#-docker-memory-limits-optional-step-2>ğŸ³ Docker Memory Limits (Optional Step 2)</a><ul><li><a href=#view-recommendations>View Recommendations</a></li><li><a href=#why-add-memory-limits>Why Add Memory Limits?</a></li><li><a href=#how-to-apply>How to Apply</a></li></ul></li><li><a href=#-understanding-the-changes>ğŸ“ Understanding the Changes</a><ul><li><a href=#common-misconceptions>Common Misconceptions</a></li><li><a href=#what-to-actually-monitor>What to Actually Monitor</a></li></ul></li><li><a href=#-expected-timeline>ğŸ“ˆ Expected Timeline</a></li><li><a href=#-troubleshooting>ğŸ”§ Troubleshooting</a><ul><li><a href=#issue-swap-io-is-very-high-siso--1000-in-vmstat>Issue: Swap I/O is very high (si/so > 1000 in vmstat)</a></li><li><a href=#issue-container-keeps-getting-oom-killed>Issue: Container keeps getting OOM killed</a></li><li><a href=#issue-system-still-feels-slow>Issue: System still feels slow</a></li></ul></li><li><a href=#-additional-resources>ğŸ“š Additional Resources</a><ul><li><a href=#files-created-by-optimization>Files Created by Optimization</a></li><li><a href=#system-configuration-files-modified>System Configuration Files Modified</a></li></ul></li><li><a href=#-summary>ğŸ¯ Summary</a><ul><li><a href=#the-core-fix>The Core Fix</a></li><li><a href=#key-takeaways>Key Takeaways</a></li><li><a href=#questions>Questions?</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Docs</a></li><li class=breadcrumb-item><a href=/docs/operations/>Operations</a></li><li class="breadcrumb-item active" aria-current=page>Performance Optimization Guide</li></ol></nav><div class=td-content><h1>Performance Optimization Guide</h1><div class=lead>System-wide performance improvements for 39 Docker containers</div><header class=article-meta></header><p><strong>Created</strong>: 2026-01-17<br><strong>System</strong>: Intel Core i5-7500T @ 2.70GHz, 8GB RAM, Ubuntu 24.04.3 LTS<br><strong>Workload</strong>: 39 Docker containers (media, monitoring, auth, smart home, etc.)</p><hr><h2 id=-problem-identified>ğŸ”´ Problem Identified</h2><h3 id=symptoms>Symptoms</h3><ul><li><strong>Severe SSH lag</strong> when connecting from LAN</li><li><strong>Slow interactive session response</strong></li><li><strong>Service latency</strong> on the local network</li></ul><h3 id=root-cause-analysis>Root Cause Analysis</h3><p>The issue was <strong>NOT</strong> what you might expect:</p><table><thead><tr><th>Assumption</th><th>Reality</th></tr></thead><tbody><tr><td>&ldquo;swappiness=10 is good for servers&rdquo;</td><td>âŒ <strong>Wrong for heavily-loaded systems</strong></td></tr><tr><td>&ldquo;Lower swappiness = better performance&rdquo;</td><td>âŒ <strong>Causes emergency swap situations</strong></td></tr><tr><td>&ldquo;My system has enough RAM&rdquo;</td><td>âŒ <strong>Only 311MB free, 92.95% committed</strong></td></tr></tbody></table><h3 id=the-real-problem>The Real Problem</h3><pre tabindex=0><code>Memory Distribution:
â”œâ”€ Total RAM:     7.6GB
â”œâ”€ Used:          4.5GB (active processes)
â”œâ”€ Inactive:      3.9GB (cached, doing nothing useful)
â”œâ”€ Free:          311MB âš ï¸ CRITICAL - too low!
â””â”€ Swap:          238MB (actively being used)

Problem: 3.9GB of INACTIVE memory hogging RAM while active 
processes fight over the remaining 311MB!
</code></pre><p>With <strong>swappiness=10</strong>, the kernel <strong>refuses to swap out inactive pages</strong> until memory pressure becomes critical. When SSH needs memory, the kernel has to perform <strong>emergency reclaim or swap operations</strong>, causing <strong>blocking I/O</strong> and the lag you experience.</p><h3 id=additional-culprit-cpu-governor>Additional Culprit: CPU Governor</h3><p><strong>Another critical factor</strong>: Intel CPUs default to <code>powersave</code> governor which:</p><ul><li>Dynamically reduces CPU frequency to save power</li><li>Adds significant latency to CPU frequency scaling transitions</li><li>Makes every command feel sluggish, even with adequate memory</li><li>Compounds the memory pressure issue</li></ul><p><strong>With <code>performance</code> governor</strong>:</p><ul><li>CPU stays at maximum frequency (3.3GHz for i5-7500T)</li><li>Eliminates frequency scaling delays</li><li>Provides consistent, low-latency performance</li><li>Dramatically improves SSH and interactive responsiveness</li></ul><hr><h2 id=-solution-multi-layered-optimization>âœ… Solution: Multi-Layered Optimization</h2><h3 id=why-swappiness60-is-better-for-your-setup>Why Swappiness=60 is Better for Your Setup</h3><table><thead><tr><th>Swappiness=10 (OLD)</th><th>Swappiness=60 (NEW)</th></tr></thead><tbody><tr><td>Avoids swapping until critical</td><td>Proactively swaps inactive pages</td></tr><tr><td>Emergency swap = lag spikes</td><td>Smooth, predictable swapping</td></tr><tr><td>3.9GB inactive memory trapped in RAM</td><td>Inactive pages swapped out early</td></tr><tr><td>~300MB free for active work</td><td>~2-3GB free for active processes</td></tr><tr><td>Sudden I/O stalls</td><td>Consistent, low-latency I/O</td></tr></tbody></table><h3 id=swappiness-values-explained>Swappiness Values Explained</h3><ul><li><strong>0-10</strong>: Desktop/workstation (user actively using most memory)</li><li><strong>20-40</strong>: Light server workload</li><li><strong>60</strong>: <strong>Heavy server workload</strong> â† Your case (39 containers)</li><li><strong>80-100</strong>: Database servers with massive cache requirements</li></ul><p>With <strong>zram swap</strong> (compressed memory), swapping is actually very fast! The kernel can quickly move inactive pages to compressed storage and free up real RAM for your SSH session.</p><hr><h2 id=-optimizations-applied>ğŸ¯ Optimizations Applied</h2><h3 id=tier-1-immediate-impact-fixes-ssh-lag>Tier 1: Immediate Impact (Fixes SSH Lag)</h3><h4 id=1-memory-management>1. Memory Management</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vm.swappiness<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span>                      <span style=color:#8f5902;font-style:italic># Proactive swapping</span>
</span></span><span style=display:flex><span>vm.vfs_cache_pressure<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>50</span>              <span style=color:#8f5902;font-style:italic># Prefer inode/dentry cache</span>
</span></span><span style=display:flex><span>vm.dirty_background_ratio<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5</span>           <span style=color:#8f5902;font-style:italic># Earlier background writeback</span>
</span></span><span style=display:flex><span>vm.dirty_ratio<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span>                     <span style=color:#8f5902;font-style:italic># Lower dirty page threshold</span>
</span></span><span style=display:flex><span>vm.dirty_writeback_centisecs<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>500</span>      <span style=color:#8f5902;font-style:italic># Regular flushing</span>
</span></span></code></pre></div><p><strong>Impact</strong>: Keeps 2-3GB RAM free for interactive sessions, prevents emergency swap situations</p><h4 id=2-network-buffer-optimization>2. Network Buffer Optimization</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>net.core.rmem_max<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4194304</span>             <span style=color:#8f5902;font-style:italic># 4MB (was 208KB)</span>
</span></span><span style=display:flex><span>net.core.wmem_max<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4194304</span>             <span style=color:#8f5902;font-style:italic># 4MB (was 208KB)</span>
</span></span><span style=display:flex><span>net.core.netdev_max_backlog<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5000</span>      <span style=color:#8f5902;font-style:italic># Higher packet queue</span>
</span></span><span style=display:flex><span>net.ipv4.tcp_congestion_control<span style=color:#ce5c00;font-weight:700>=</span>bbr   <span style=color:#8f5902;font-style:italic># Modern congestion control</span>
</span></span></code></pre></div><p><strong>Impact</strong>: 20x larger buffers = better throughput to LAN clients, reduced latency</p><h3 id=tier-2-hardware-optimization>Tier 2: Hardware Optimization</h3><h4 id=3-network-offload-features>3. Network Offload Features</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>- TSO <span style=color:#ce5c00;font-weight:700>(</span>TCP Segmentation Offload<span style=color:#ce5c00;font-weight:700>)</span>: Enabled
</span></span><span style=display:flex><span>- GSO <span style=color:#ce5c00;font-weight:700>(</span>Generic Segmentation Offload<span style=color:#ce5c00;font-weight:700>)</span>: Enabled
</span></span><span style=display:flex><span>- GRO <span style=color:#ce5c00;font-weight:700>(</span>Generic Receive Offload<span style=color:#ce5c00;font-weight:700>)</span>: Enabled
</span></span></code></pre></div><p><strong>Impact</strong>: Reduces CPU usage for network I/O, improves throughput</p><h3 id=tier-3-additional-improvements>Tier 3: Additional Improvements</h3><h4 id=4-file-descriptor-limits>4. File Descriptor Limits</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fs.file-max<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2097152</span>                   <span style=color:#8f5902;font-style:italic># System-wide</span>
</span></span><span style=display:flex><span>fs.nr_open<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2097152</span>                    <span style=color:#8f5902;font-style:italic># Per-process</span>
</span></span></code></pre></div><p><strong>Impact</strong>: Prevents &ldquo;too many open files&rdquo; errors with Docker</p><h4 id=5-kernel-scheduler-tuning>5. Kernel Scheduler Tuning</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kernel.sched_migration_cost_ns<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5000000</span>  <span style=color:#8f5902;font-style:italic># Reduce unnecessary migrations</span>
</span></span><span style=display:flex><span>kernel.sched_autogroup_enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>        <span style=color:#8f5902;font-style:italic># Disable desktop optimization</span>
</span></span></code></pre></div><p><strong>Impact</strong>: Better for server workloads</p><hr><h2 id=-how-to-apply>ğŸ“‹ How to Apply</h2><h3 id=quick-start>Quick Start</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Navigate to your home-server directory</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ~/home-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Run the optimization script (requires sudo)</span>
</span></span><span style=display:flex><span>sudo ./scripts/optimize-performance.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. (Optional but recommended) Reboot for full effect</span>
</span></span><span style=display:flex><span>sudo reboot
</span></span></code></pre></div><h3 id=what-the-script-does>What the Script Does</h3><ol><li>âœ… <strong>Creates backups</strong> of all current settings</li><li>âœ… <strong>Applies optimizations</strong> across 3 tiers</li><li>âœ… <strong>Validates changes</strong> and saves before/after state</li><li>âœ… <strong>Creates rollback script</strong> for safety</li><li>âœ… <strong>Persists settings</strong> across reboots</li></ol><h3 id=safety-features>Safety Features</h3><ul><li><strong>Full backup</strong> before any changes</li><li><strong>Automatic rollback script</strong> generation</li><li><strong>Detailed logging</strong> of all operations</li><li><strong>Pre-flight checks</strong> to prevent issues</li></ul><hr><h2 id=-rollback-instructions>ğŸ”„ Rollback Instructions</h2><p>If you need to revert the changes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Find your backup directory (printed during optimization)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ~/home-server/backups/performance-tuning-YYYYMMDD-HHMMSS/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run the rollback script</span>
</span></span><span style=display:flex><span>sudo ./rollback.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Reboot</span>
</span></span><span style=display:flex><span>sudo reboot
</span></span></code></pre></div><hr><h2 id=-monitoring-your-system>ğŸ“Š Monitoring Your System</h2><h3 id=before-optimization-metrics>Before Optimization Metrics</h3><pre tabindex=0><code>Load Average: 1.06, 0.95, 0.97
Memory Free: 311MB
Swap Used: 238MB
Network Buffers: 208KB
TCP Offload: Disabled
</code></pre><h3 id=monitor-after-optimization>Monitor After Optimization</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check memory usage</span>
</span></span><span style=display:flex><span>free -h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Monitor swap activity (should be more but smoother)</span>
</span></span><span style=display:flex><span>vmstat <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check network statistics</span>
</span></span><span style=display:flex><span>sar -n DEV <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View Docker container stats</span>
</span></span><span style=display:flex><span>docker stats
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check applied sysctl values</span>
</span></span><span style=display:flex><span>sysctl -a <span style=color:#000;font-weight:700>|</span> grep -E <span style=color:#4e9a06>&#39;(vm.swappiness|net.core)&#39;</span>
</span></span></code></pre></div><h3 id=expected-improvements>Expected Improvements</h3><ul><li><strong>SSH latency</strong>: Immediate improvement (should feel snappy)</li><li><strong>Free memory</strong>: Increase to 1-3GB within hours</li><li><strong>Swap usage</strong>: May increase (this is GOOD - it&rsquo;s swapping out inactive pages)</li><li><strong>Network throughput</strong>: Better performance for LAN clients</li><li><strong>Overall responsiveness</strong>: Smoother, more predictable</li></ul><hr><h2 id=-docker-memory-limits-optional-step-2>ğŸ³ Docker Memory Limits (Optional Step 2)</h2><p>After kernel optimizations, consider adding memory limits to containers.</p><h3 id=view-recommendations>View Recommendations</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./scripts/add-docker-memory-limits.sh
</span></span></code></pre></div><p>This shows recommended memory limits for all your containers.</p><h3 id=why-add-memory-limits>Why Add Memory Limits?</h3><ul><li>Prevents memory hogging by any single container</li><li>Allows Docker to make better scheduling decisions</li><li>Works with kernel&rsquo;s memory management</li><li>Provides predictable resource allocation</li></ul><h3 id=how-to-apply>How to Apply</h3><ol><li><p><strong>Backup docker-compose.yml</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp ~/home-server/docker-compose.yml ~/home-server/docker-compose.yml.backup
</span></span></code></pre></div></li><li><p><strong>Add deploy sections</strong> from the script output to your services</p></li><li><p><strong>Recreate containers</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/home-server
</span></span><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div></li></ol><hr><h2 id=-understanding-the-changes>ğŸ“ Understanding the Changes</h2><h3 id=common-misconceptions>Common Misconceptions</h3><h4 id=-swap-is-always-bad>âŒ &ldquo;Swap is always bad&rdquo;</h4><p><strong>Reality</strong>: Swap is a tool. Used proactively (swappiness=60), it keeps RAM free for active processes.</p><h4 id=-lower-swappiness--faster-system>âŒ &ldquo;Lower swappiness = faster system&rdquo;</h4><p><strong>Reality</strong>: Lower swappiness works for desktops where you actively use most memory. For servers with many containers, higher swappiness prevents emergency swap situations.</p><h4 id=-if-swap-usage-increases-something-is-wrong>âŒ &ldquo;If swap usage increases, something is wrong&rdquo;</h4><p><strong>Reality</strong>: Swap usage SHOULD increase with swappiness=60. It&rsquo;s swapping out inactive pages. Watch for <strong>swap I/O</strong> (si/so in vmstat), not swap usage.</p><h3 id=what-to-actually-monitor>What to Actually Monitor</h3><p>âœ… <strong>Good indicators</strong>:</p><ul><li>Free memory (should increase)</li><li>SSH responsiveness (should improve)</li><li>Load average (should stabilize)</li><li>Swap I/O rate (si/so) - should be low and steady</li></ul><p>âŒ <strong>Don&rsquo;t worry about</strong>:</p><ul><li>Swap usage % (will likely increase)</li><li>Cache size (will decrease as inactive pages are swapped)</li></ul><hr><h2 id=-expected-timeline>ğŸ“ˆ Expected Timeline</h2><table><thead><tr><th>Time</th><th>Expected Behavior</th></tr></thead><tbody><tr><td><strong>Immediate</strong></td><td>SSH latency improves, network feels snappier</td></tr><tr><td><strong>5-10 min</strong></td><td>Kernel starts swapping out inactive pages</td></tr><tr><td><strong>30-60 min</strong></td><td>Free memory increases to 1-2GB</td></tr><tr><td><strong>2-4 hours</strong></td><td>System reaches new equilibrium</td></tr><tr><td><strong>1-2 days</strong></td><td>Full performance characteristics visible</td></tr></tbody></table><hr><h2 id=-troubleshooting>ğŸ”§ Troubleshooting</h2><h3 id=issue-swap-io-is-very-high-siso--1000-in-vmstat>Issue: Swap I/O is very high (si/so > 1000 in vmstat)</h3><p><strong>Solution</strong>: System is thrashing. You may have too many containers for 8GB RAM.</p><ul><li>Consider adding more RAM</li><li>Or reduce number of running containers</li><li>Or adjust swappiness to 40-50 (middle ground)</li></ul><h3 id=issue-container-keeps-getting-oom-killed>Issue: Container keeps getting OOM killed</h3><p><strong>Solution</strong>: Container needs more memory</p><ul><li>Check <code>docker logs &lt;container></code></li><li>Increase memory limit in docker-compose.yml</li><li>Or investigate why it&rsquo;s using so much memory</li></ul><h3 id=issue-system-still-feels-slow>Issue: System still feels slow</h3><p><strong>Diagnosis</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check I/O wait</span>
</span></span><span style=display:flex><span>vmstat <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check disk performance</span>
</span></span><span style=display:flex><span>iostat -x <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check network errors</span>
</span></span><span style=display:flex><span>netstat -i
</span></span></code></pre></div><hr><h2 id=-additional-resources>ğŸ“š Additional Resources</h2><h3 id=files-created-by-optimization>Files Created by Optimization</h3><pre tabindex=0><code>~/home-server/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ optimize-performance.sh          # Main optimization script
â”‚   â””â”€â”€ add-docker-memory-limits.sh      # Docker limits helper
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ performance-optimization.log     # Execution log
â”œâ”€â”€ backups/
â”‚   â””â”€â”€ performance-tuning-TIMESTAMP/    # Backup &amp; rollback
â”‚       â”œâ”€â”€ rollback.sh                  # Rollback script
â”‚       â”œâ”€â”€ sysctl-before.conf           # Original settings
â”‚       â”œâ”€â”€ sysctl-after.conf            # New settings
â”‚       â””â”€â”€ *.txt                        # Various metrics
â””â”€â”€ PERFORMANCE_OPTIMIZATION.md          # This file
</code></pre><h3 id=system-configuration-files-modified>System Configuration Files Modified</h3><pre tabindex=0><code>/etc/sysctl.d/
â”œâ”€â”€ 99-swappiness.conf              # Memory swapping behavior
â”œâ”€â”€ 99-vfs-cache.conf               # Filesystem cache pressure
â”œâ”€â”€ 99-dirty-pages.conf             # Page writeback tuning
â”œâ”€â”€ 99-network-performance.conf     # Network buffer optimization
â”œâ”€â”€ 99-file-descriptors.conf        # File descriptor limits
â””â”€â”€ 99-kernel-performance.conf      # Misc kernel tuning

/etc/systemd/system/
â””â”€â”€ network-offload-optimization.service   # Persist NIC offload

/etc/security/
â””â”€â”€ limits.conf                     # User process limits
</code></pre><hr><h2 id=-summary>ğŸ¯ Summary</h2><h3 id=the-core-fix>The Core Fix</h3><p>Your SSH lag was caused by <strong>memory pressure</strong>, not by swappiness being too high, but by swappiness being <strong>too low</strong> for your workload.</p><p><strong>The fix</strong>: Increase swappiness to 60 so the kernel proactively swaps out inactive memory pages, keeping more RAM free for your interactive SSH sessions.</p><h3 id=key-takeaways>Key Takeaways</h3><ol><li><strong>Swappiness is workload-dependent</strong> - 10 is great for desktops, 60 is better for heavily-loaded servers</li><li><strong>Swap usage is not inherently bad</strong> - it&rsquo;s a tool for better memory management</li><li><strong>Free RAM is more important than avoiding swap</strong> - for interactive responsiveness</li><li><strong>Network buffers matter</strong> - especially with 39 containers on gigabit LAN</li><li><strong>Hardware offload helps</strong> - reduces CPU overhead for network I/O</li></ol><h3 id=questions>Questions?</h3><p>Check the logs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat ~/home-server/logs/performance-optimization.log
</span></span></code></pre></div><p>Or review the backup for original values:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -la ~/home-server/backups/performance-tuning-*/
</span></span></code></pre></div><hr><p><strong>Last Updated</strong>: 2026-01-17<br><strong>Script Version</strong>: 1.0<br><strong>Status</strong>: Ready for production use</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Homepage aria-label=Homepage><a target=_blank rel=noopener href=https://homepage.antoineglacet.com aria-label=Homepage><i class="fa fa-home"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Antoine Glacet</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.258190f24d50bde9095e369c0cd7315407f95e1da5f39472b3850b40279a9e08.js integrity="sha256-JYGQ8k1QvekJXjacDNcxVAf5Xh2l85Rys4ULQCeangg=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>