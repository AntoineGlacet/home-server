<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Monitoring & Observability | Home Server Documentation</title><meta name=description content="Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting"><meta property="og:url" content="https://docs.antoineglacet.com/docs/monitoring/monitoring/"><meta property="og:site_name" content="Home Server Documentation"><meta property="og:title" content="Monitoring & Observability"><meta property="og:description" content="Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Monitoring & Observability"><meta itemprop=description content="Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting"><meta itemprop=wordCount content="1237"><meta name=twitter:card content="summary"><meta name=twitter:title content="Monitoring & Observability"><meta name=twitter:description content="Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting"><link rel=preload href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css as=style integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><link href=/scss/main.min.6d849f713d8c25ed95d783569522ad6e1604c48142bc1d1ab44b4a15795b3046.css rel=stylesheet integrity="sha256-bYSfcT2MJe2V14NWlSKtbhYExIFCvB0atEtKFXlbMEY=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Home Server Documentation</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=https://homepage.antoineglacet.com target=_blank rel=noopener><span>Homepage</span></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main data-bs-spy=scroll data-bs-target=.td-toc data-bs-root-margin="0px 0px -10%"><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><script>$(function(){$("#td-section-nav a").removeClass("active"),$("#td-section-nav #m-docsmonitoringmonitoring").addClass("active"),$("#td-section-nav #m-docsmonitoringmonitoring-li span").addClass("td-sidebar-nav-active-item"),$("#td-section-nav #m-docsmonitoringmonitoring").parents("li").addClass("active-path"),$("#td-section-nav li.active-path").addClass("show"),$("#td-section-nav li.active-path").children("input").prop("checked",!0),$("#td-section-nav #m-docsmonitoringmonitoring-li").siblings("li").addClass("show"),$("#td-section-nav #m-docsmonitoringmonitoring-li").children("ul").children("li").addClass("show"),$("#td-sidebar-menu").toggleClass("d-none")})</script><div id=td-sidebar-menu class="td-sidebar__inner d-none"><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-li><a href=/docs/ title=Documentation class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Docs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsoperations-li><input type=checkbox id=m-docsoperations-check>
<label for=m-docsoperations-check><a href=/docs/operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsoperations><span>Operations</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsoperating-li><input type=checkbox id=m-docsoperationsoperating-check>
<label for=m-docsoperationsoperating-check><a href=/docs/operations/operating/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsoperating><span>Operating Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsquick_start-li><input type=checkbox id=m-docsoperationsquick_start-check>
<label for=m-docsoperationsquick_start-check><a href=/docs/operations/quick_start/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquick_start><span>Quick Start: Fix SSH Lag & LAN Latency</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance-tuning-li><input type=checkbox id=m-docsoperationsperformance-tuning-check>
<label for=m-docsoperationsperformance-tuning-check><a href=/docs/operations/performance-tuning/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance-tuning><span>Performance Tuning Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoperationsperformance_optimization-li><input type=checkbox id=m-docsoperationsperformance_optimization-check>
<label for=m-docsoperationsperformance_optimization-check><a href=/docs/operations/performance_optimization/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsperformance_optimization><span>Performance Optimization Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsinfrastructure-li><input type=checkbox id=m-docsinfrastructure-check>
<label for=m-docsinfrastructure-check><a href=/docs/infrastructure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsinfrastructure><span>Infrastructure</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructuretraefik-li><input type=checkbox id=m-docsinfrastructuretraefik-check>
<label for=m-docsinfrastructuretraefik-check><a href=/docs/infrastructure/traefik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructuretraefik><span>Traefik - Reverse Proxy & TLS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinfrastructureauthentik-li><input type=checkbox id=m-docsinfrastructureauthentik-check>
<label for=m-docsinfrastructureauthentik-check><a href=/docs/infrastructure/authentik/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsinfrastructureauthentik><span>Authentik - SSO & Authentication</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsmonitoring-li><input type=checkbox id=m-docsmonitoring-check>
<label for=m-docsmonitoring-check><a href=/docs/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsmonitoring><span>Monitoring</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringmonitoring-li><input type=checkbox id=m-docsmonitoringmonitoring-check>
<label for=m-docsmonitoringmonitoring-check><a href=/docs/monitoring/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringmonitoring><span>Monitoring & Observability</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmonitoringgrafana-setup-li><input type=checkbox id=m-docsmonitoringgrafana-setup-check>
<label for=m-docsmonitoringgrafana-setup-check><a href=/docs/monitoring/grafana-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmonitoringgrafana-setup><span>Grafana Setup Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstroubleshooting-li><input type=checkbox id=m-docstroubleshooting-check>
<label for=m-docstroubleshooting-check><a href=/docs/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docstroubleshooting><span>Troubleshooting</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstroubleshootingtroubleshooting-li><input type=checkbox id=m-docstroubleshootingtroubleshooting-check>
<label for=m-docstroubleshootingtroubleshooting-check><a href=/docs/troubleshooting/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstroubleshootingtroubleshooting><span>Troubleshooting Guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdeployment-li><input type=checkbox id=m-docsdeployment-check>
<label for=m-docsdeployment-check><a href=/docs/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdeployment><span>Deployment</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_checklist-li><input type=checkbox id=m-docsdeploymentdeployment_checklist-check>
<label for=m-docsdeploymentdeployment_checklist-check><a href=/docs/deployment/deployment_checklist/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_checklist><span>Deployment Checklist - Infrastructure Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentpost-commit-steps-li><input type=checkbox id=m-docsdeploymentpost-commit-steps-check>
<label for=m-docsdeploymentpost-commit-steps-check><a href=/docs/deployment/post-commit-steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentpost-commit-steps><span>Post-Commit Setup Steps</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentdeployment_notes-li><input type=checkbox id=m-docsdeploymentdeployment_notes-check>
<label for=m-docsdeploymentdeployment_notes-check><a href=/docs/deployment/deployment_notes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentdeployment_notes><span>Deployment Notes - 2026-01-16</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymenthugo-site-setup-li><input type=checkbox id=m-docsdeploymenthugo-site-setup-check>
<label for=m-docsdeploymenthugo-site-setup-check><a href=/docs/deployment/hugo-site-setup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymenthugo-site-setup><span>Hugo Documentation Site - Setup Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentalerting_migration-li><input type=checkbox id=m-docsdeploymentalerting_migration-check>
<label for=m-docsdeploymentalerting_migration-check><a href=/docs/deployment/alerting_migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentalerting_migration><span>Alerting Migration to Grafana</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdeploymentreadme-li><input type=checkbox id=m-docsdeploymentreadme-check>
<label for=m-docsdeploymentreadme-check><a href=/docs/deployment/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdeploymentreadme><span></span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsplanning-li><input type=checkbox id=m-docsplanning-check>
<label for=m-docsplanning-check><a href=/docs/planning/ title="Planning & Status" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsplanning><span>Planning</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningimplementation_status-li><input type=checkbox id=m-docsplanningimplementation_status-check>
<label for=m-docsplanningimplementation_status-check><a href=/docs/planning/implementation_status/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningimplementation_status><span>Implementation Status - Home Server Improvements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningnext_steps-li><input type=checkbox id=m-docsplanningnext_steps-check>
<label for=m-docsplanningnext_steps-check><a href=/docs/planning/next_steps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningnext_steps><span>Next Steps - Alerting Migration Testing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningsecurity_remediation-li><input type=checkbox id=m-docsplanningsecurity_remediation-check>
<label for=m-docsplanningsecurity_remediation-check><a href=/docs/planning/security_remediation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningsecurity_remediation><span>Security Remediation: Discord Webhook Leak</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsplanningreadme-li><input type=checkbox id=m-docsplanningreadme-check>
<label for=m-docsplanningreadme-check><a href=/docs/planning/readme/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsplanningreadme><span></span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc data-proofer-ignore><div class=td-toc-title><span class=td-toc-title__text>On this page</span>
<a class=td-toc-title__link title="Top of page" href=#></a></div><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#overview>Overview</a><ul><li><a href=#monitoring-stack>Monitoring Stack</a></li><li><a href=#data-flow>Data Flow</a></li></ul></li><li><a href=#prometheus>Prometheus</a><ul><li><a href=#overview-1>Overview</a></li><li><a href=#scrape-targets>Scrape Targets</a></li><li><a href=#viewing-targets>Viewing Targets</a></li><li><a href=#query-examples>Query Examples</a></li><li><a href=#storage--retention>Storage & Retention</a></li><li><a href=#backups>Backups</a></li></ul></li><li><a href=#grafana>Grafana</a><ul><li><a href=#overview-2>Overview</a></li><li><a href=#datasources>Datasources</a></li><li><a href=#dashboards>Dashboards</a></li><li><a href=#oauth-integration>OAuth Integration</a></li><li><a href=#useful-queries>Useful Queries</a></li></ul></li><li><a href=#loki--promtail>Loki & Promtail</a><ul><li><a href=#overview-3>Overview</a></li><li><a href=#how-it-works>How It Works</a></li><li><a href=#configuration>Configuration</a></li><li><a href=#storage--retention-1>Storage & Retention</a></li><li><a href=#querying-logs>Querying Logs</a></li><li><a href=#log-labels>Log Labels</a></li></ul></li><li><a href=#exporters>Exporters</a><ul><li><a href=#node-exporter>Node Exporter</a></li><li><a href=#cadvisor>cAdvisor</a></li><li><a href=#blackbox-exporter>Blackbox Exporter</a></li></ul></li><li><a href=#alerting>Alerting</a><ul><li><a href=#migration-to-grafana-unified-alerting>Migration to Grafana Unified Alerting</a></li><li><a href=#alert-configuration>Alert Configuration</a></li><li><a href=#alert-rules>Alert Rules</a></li><li><a href=#contact-points>Contact Points</a></li><li><a href=#managing-alerts>Managing Alerts</a></li><li><a href=#common-alert-rules>Common Alert Rules</a></li></ul></li><li><a href=#glances>Glances</a><ul><li><a href=#overview-4>Overview</a></li><li><a href=#features>Features</a></li><li><a href=#configuration-1>Configuration</a></li><li><a href=#api-access>API Access</a></li><li><a href=#useful-views>Useful Views</a></li></ul></li><li><a href=#best-practices>Best Practices</a><ul><li><a href=#monitoring>Monitoring</a></li><li><a href=#performance>Performance</a></li><li><a href=#alerting-1>Alerting</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Docs</a></li><li class=breadcrumb-item><a href=/docs/monitoring/>Monitoring</a></li><li class="breadcrumb-item active" aria-current=page>Monitoring & Observability</li></ol></nav><div class=td-content><h1>Monitoring & Observability</h1><div class=lead>Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting</div><header class=article-meta></header><p>Complete guide to the monitoring stack: Prometheus, Grafana, Loki, and alerting.</p><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=#overview>Overview</a></li><li><a href=#prometheus>Prometheus</a></li><li><a href=#grafana>Grafana</a></li><li><a href=#loki--promtail>Loki & Promtail</a></li><li><a href=#exporters>Exporters</a></li><li><a href=#alerting>Alerting</a></li><li><a href=#glances>Glances</a></li></ul><h2 id=overview>Overview</h2><h3 id=monitoring-stack>Monitoring Stack</h3><table><thead><tr><th>Component</th><th>Purpose</th><th>Access</th></tr></thead><tbody><tr><td><strong>Prometheus</strong></td><td>Metrics collection & storage</td><td>http://localhost:9090</td></tr><tr><td><strong>Grafana</strong></td><td>Dashboards & alerting</td><td><a href=https://grafana.antoineglacet.com>https://grafana.antoineglacet.com</a></td></tr><tr><td><strong>Loki</strong></td><td>Log aggregation</td><td>http://loki:3100 (internal)</td></tr><tr><td><strong>Promtail</strong></td><td>Log collection</td><td>Daemon (no UI)</td></tr><tr><td><strong>cAdvisor</strong></td><td>Container metrics</td><td>http://localhost:8080</td></tr><tr><td><strong>Node Exporter</strong></td><td>Host system metrics</td><td>http://172.17.0.1:9100</td></tr><tr><td><strong>Blackbox Exporter</strong></td><td>Network probes</td><td>Internal</td></tr><tr><td><strong>Glances</strong></td><td>Real-time monitor</td><td><a href=https://glances.antoineglacet.com>https://glances.antoineglacet.com</a></td></tr></tbody></table><h3 id=data-flow>Data Flow</h3><pre tabindex=0><code>Metrics:  Exporters → Prometheus → Grafana → Dashboards
Logs:     Containers → Promtail → Loki → Grafana → Explore
Alerts:   Prometheus → Grafana Alerting → Discord
</code></pre><h2 id=prometheus>Prometheus</h2><h3 id=overview-1>Overview</h3><p>Prometheus scrapes metrics from various targets and stores them in a time-series database.</p><p><strong>Access:</strong> http://localhost:9090</p><h3 id=scrape-targets>Scrape Targets</h3><p>Configured in <code>config/prometheus/prometheus.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scrape_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;prometheus&#39;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Self-monitoring</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>15s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;localhost:9090&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;node_exporter&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Host metrics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;172.17.0.1:9100&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;cadvisor&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Container metrics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>30s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cadvisor:8080&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;traefik&#39;</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Reverse proxy metrics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>15s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;traefik:8082&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;loki&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Log system metrics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>30s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;loki:3100&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;blackbox_icmp&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Network latency (ping)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#0000cf;font-weight:700>10.13.1.1</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Gateway</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#0000cf;font-weight:700>8.8.8.8</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Google DNS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#0000cf;font-weight:700>1.1.1.1</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Cloudflare DNS</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=viewing-targets>Viewing Targets</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check target status in UI</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># http://localhost:9090/targets</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Via API</span>
</span></span><span style=display:flex><span>curl http://localhost:9090/api/v1/targets <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;.data.activeTargets[] | {job: .labels.job, health: .health}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Unhealthy targets</span>
</span></span><span style=display:flex><span>curl http://localhost:9090/api/v1/targets <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;.data.activeTargets[] | select(.health != &#34;up&#34;)&#39;</span>
</span></span></code></pre></div><h3 id=query-examples>Query Examples</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># CPU usage by container</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_cpu_usage_seconds_total</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Memory usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>container_memory_usage_bytes</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Convert to MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Disk space free</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>node_filesystem_avail_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mountpoint</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>/</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#000>node_filesystem_size_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mountpoint</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>/</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Network traffic</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>node_network_receive_bytes_total</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># HTTP request rate (Traefik)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>traefik_service_requests_total</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=storage--retention>Storage & Retention</h3><p>Data stored in: <code>data/prometheus/</code></p><p><strong>Default retention:</strong> 15 days</p><p><strong>Change retention:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># In docker-compose.yml, add to command:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#39;--storage.tsdb.retention.time=30d&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#39;--storage.tsdb.path=/prometheus&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=backups>Backups</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Backup Prometheus data</span>
</span></span><span style=display:flex><span>tar -czf ~/prometheus-backup-<span style=color:#204a87;font-weight:700>$(</span>date +%F<span style=color:#204a87;font-weight:700>)</span>.tar.gz data/prometheus/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Restore</span>
</span></span><span style=display:flex><span>docker compose stop prometheus
</span></span><span style=display:flex><span>tar -xzf ~/prometheus-backup-2026-01-24.tar.gz
</span></span><span style=display:flex><span>docker compose start prometheus
</span></span></code></pre></div><h2 id=grafana>Grafana</h2><h3 id=overview-2>Overview</h3><p>Grafana visualizes metrics from Prometheus and logs from Loki.</p><p><strong>Access:</strong> <a href=https://grafana.antoineglacet.com>https://grafana.antoineglacet.com</a> (auto-login via Authentik)</p><h3 id=datasources>Datasources</h3><p>Provisioned automatically from <code>config/grafana/provisioning/datasources/</code>:</p><ol><li><strong>Prometheus</strong> - Metrics</li><li><strong>Loki</strong> - Logs</li></ol><p><strong>Verify datasources:</strong></p><ul><li>Grafana → Configuration → Data sources</li><li>Or: http://localhost:3000/api/datasources</li></ul><h3 id=dashboards>Dashboards</h3><h4 id=pre-configured-dashboards>Pre-configured Dashboards</h4><p>Located in <code>config/grafana/dashboards/</code>:</p><ol><li><strong>Node Exporter Full</strong> - Host metrics (CPU, RAM, disk, network)</li><li><strong>Docker Container Metrics</strong> - Per-container resource usage</li><li><strong>Traefik Dashboard</strong> - Request rates, errors, response times</li><li><strong>Loki Logs</strong> - Centralized log viewer</li></ol><h4 id=adding-custom-dashboards>Adding Custom Dashboards</h4><p><strong>Method 1: Via UI</strong></p><ol><li>Create dashboard in Grafana</li><li>Share → Export → Save JSON</li><li>Copy to <code>config/grafana/dashboards/my-dashboard.json</code></li><li>Restart Grafana</li></ol><p><strong>Method 2: Import</strong></p><ol><li>Find dashboard on <a href=https://grafana.com/dashboards>https://grafana.com/dashboards</a></li><li>Copy dashboard ID</li><li>Grafana → Import → Enter ID</li></ol><p><strong>Method 3: Provisioning</strong></p><p>Add to <code>config/grafana/provisioning/dashboards/</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># dashboards.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>providers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;default&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>folder</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/grafana/dashboards</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=oauth-integration>OAuth Integration</h3><p>Grafana uses Authentik for authentication.</p><p><strong>Configuration in <code>.env</code>:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_CLIENT_ID</span><span style=color:#ce5c00;font-weight:700>=</span>xxx
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET</span><span style=color:#ce5c00;font-weight:700>=</span>xxx
</span></span><span style=display:flex><span><span style=color:#000>GF_AUTH_OAUTH_AUTO_LOGIN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#000>GF_SERVER_ROOT_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://grafana.antoineglacet.com
</span></span></code></pre></div><p>See <a href=authentik.md#grafana-oauth-integration>Authentik documentation</a> for setup.</p><h3 id=useful-queries>Useful Queries</h3><h4 id=loki-logs>Loki (Logs)</h4><pre tabindex=0><code class=language-logql data-lang=logql># All logs from a container
{container_name=&#34;traefik&#34;}

# Error logs across all containers
{job=&#34;docker&#34;} |= &#34;error&#34;

# Failed authentication attempts
{container_name=&#34;authentik-server&#34;} |= &#34;failed&#34; |= &#34;login&#34;

# Traefik 5xx errors
{container_name=&#34;traefik&#34;} |~ &#34;HTTP/[0-9.]+ 5[0-9]{2}&#34;

# Rate of errors
rate({job=&#34;docker&#34;} |= &#34;error&#34;[5m])
</code></pre><h4 id=prometheus-metrics>Prometheus (Metrics)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container CPU usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_cpu_usage_seconds_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>by</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container memory usage (MB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_memory_usage_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>by</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Disk usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>node_filesystem_avail_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mountpoint</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>/</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#000>node_filesystem_size_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mountpoint</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>/</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Network throughput</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>node_network_receive_bytes_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>eth0</span><span style=color:#000;font-weight:700>&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Traefik response time (95th percentile)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>histogram_quantile</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.95</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>traefik_service_request_duration_seconds_bucket</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>))</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=loki--promtail>Loki & Promtail</h2><h3 id=overview-3>Overview</h3><p>Loki aggregates logs from all Docker containers. Promtail collects and ships logs to Loki.</p><h3 id=how-it-works>How It Works</h3><ol><li>Promtail tails <code>/var/lib/docker/containers/</code> (via Docker socket mount)</li><li>Adds labels (container name, image, etc.)</li><li>Streams logs to Loki</li><li>Loki indexes labels, stores logs</li><li>Query via Grafana → Explore → Loki</li></ol><h3 id=configuration>Configuration</h3><p><strong>Promtail:</strong> <code>config/promtail/config.yaml</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scrape_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_sd_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>unix:///var/run/docker.sock</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>relabel_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>source_labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;__meta_docker_container_name&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>target_label</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;container_name&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Loki:</strong> <code>config/loki/local-config.yaml</code></p><h3 id=storage--retention-1>Storage & Retention</h3><p><strong>Data location:</strong> <code>data/loki/</code></p><p><strong>Retention</strong> (default: 744h = 31 days):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># config/loki/local-config.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>limits_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>retention_period</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>744h</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add compactor for cleanup:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>compactor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>working_directory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/loki/compactor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>shared_store</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>filesystem</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>retention_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>retention_delete_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>2h</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=querying-logs>Querying Logs</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Via Grafana</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://grafana.antoineglacet.com → Explore → Loki</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Common queries:</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>container_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;traefik&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;docker&#34;</span><span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#000;font-weight:700>|</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;error&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>container_name</span><span style=color:#ce5c00;font-weight:700>=</span>~<span style=color:#4e9a06>&#34;authentik.*&#34;</span><span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#000;font-weight:700>|</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;failed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Live tail in Grafana (top right: Live button)</span>
</span></span></code></pre></div><h3 id=log-labels>Log Labels</h3><p>Available labels:</p><ul><li><code>container_name</code>: Docker container name</li><li><code>container_id</code>: Full container ID</li><li><code>job</code>: Always &ldquo;docker&rdquo;</li><li><code>stream</code>: stdout or stderr</li></ul><h2 id=exporters>Exporters</h2><h3 id=node-exporter>Node Exporter</h3><p>Collects host system metrics.</p><p><strong>Runs on:</strong> Host network (port 9100)</p><p><strong>Metrics:</strong></p><ul><li>CPU usage</li><li>Memory usage</li><li>Disk I/O</li><li>Network traffic</li><li>System load</li><li>Filesystem usage</li></ul><p><strong>Example queries:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># CPU usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>avg</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>by</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>instance</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>node_cpu_seconds_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>idle</span><span style=color:#000;font-weight:700>&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Memory usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>node_memory_MemTotal_bytes</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8> </span><span style=color:#000>node_memory_MemAvailable_bytes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Disk free</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>node_filesystem_avail_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mountpoint</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>/</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=cadvisor>cAdvisor</h3><p>Collects Docker container metrics.</p><p><strong>Access:</strong> http://localhost:8080</p><p><strong>Metrics:</strong></p><ul><li>CPU usage per container</li><li>Memory usage per container</li><li>Network I/O per container</li><li>Filesystem I/O per container</li></ul><p><strong>Example queries:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container CPU usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_cpu_usage_seconds_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container memory</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>container_memory_usage_bytes</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Top 10 CPU consumers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>topk</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_cpu_usage_seconds_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>))</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=blackbox-exporter>Blackbox Exporter</h3><p>Performs network probes (ICMP, HTTP, DNS).</p><p><strong>Configuration:</strong> <code>config/blackbox-exporter/blackbox.yml</code></p><p><strong>Probes:</strong></p><ul><li>ICMP (ping) to: Gateway, Google DNS, Cloudflare DNS, MS Teams</li><li>HTTP checks: google.com, teams.microsoft.com, cloudflare.com</li><li>DNS queries to: 8.8.8.8, 1.1.1.1</li></ul><p><strong>Example queries:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Ping latency</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>probe_duration_seconds</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>job</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>blackbox_icmp</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># HTTP probe success rate</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>probe_success</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>job</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>blackbox_http</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Internet down alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>probe_success</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>instance</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>8.8.8.8</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=alerting>Alerting</h2><h3 id=migration-to-grafana-unified-alerting>Migration to Grafana Unified Alerting</h3><p><strong>Note:</strong> Alerting migrated from Alertmanager to Grafana (Jan 2026).</p><p>See <code>ALERTING_MIGRATION.md</code> for full details.</p><h3 id=alert-configuration>Alert Configuration</h3><p><strong>Location:</strong> <code>config/grafana/provisioning/alerting/</code></p><pre tabindex=0><code>alerting/
├── rules.yml          # Alert rules
├── policies.yml       # Notification policies
└── contactpoints.yml  # Discord webhook
</code></pre><h3 id=alert-rules>Alert Rules</h3><p>Example alert rules in <code>rules.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infrastructure</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>HighCPU</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>(100 - avg(rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[5m])) * 100) &gt; 80</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>5m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>High CPU usage detected</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>HighMemory</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes &gt; 0.90</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>5m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>High memory usage detected</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DiskSpaceLow</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>(node_filesystem_avail_bytes{mountpoint=&#34;/&#34;} / node_filesystem_size_bytes{mountpoint=&#34;/&#34;}) * 100 &lt; 10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Disk space critically low</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=contact-points>Contact Points</h3><p>Configure Discord webhook in <code>.env</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>DISCORD_WEBHOOK_URL</span><span style=color:#ce5c00;font-weight:700>=</span>https://discord.com/api/webhooks/YOUR_ID/YOUR_TOKEN
</span></span></code></pre></div><p><strong>Test webhook:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -d <span style=color:#4e9a06>&#39;{&#34;content&#34;:&#34;Test alert from home server&#34;}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#000>$DISCORD_WEBHOOK_URL</span>
</span></span></code></pre></div><h3 id=managing-alerts>Managing Alerts</h3><p><strong>View alerts:</strong></p><ul><li>Grafana → Alerting → Alert rules</li></ul><p><strong>Silence alerts:</strong></p><ul><li>Grafana → Alerting → Silences → New silence</li></ul><p><strong>View alert history:</strong></p><ul><li>Grafana → Alerting → Alert instances</li></ul><h3 id=common-alert-rules>Common Alert Rules</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container down</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>absent</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>up</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>job</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>cadvisor</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Container restarting</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>container_last_seen</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>name</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#000;font-weight:700>&#34;&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Traefik service error rate</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>rate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>traefik_service_requests_total</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>code</span><span style=color:#ce5c00;font-weight:700>=~</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>5..</span><span style=color:#000;font-weight:700>&#34;}[</span><span style=color:#4e9a06>5m</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.05</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Internet connectivity</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>probe_success</span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>instance</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&#34;</span><span style=color:#4e9a06>8.8.8.8</span><span style=color:#000;font-weight:700>&#34;}</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Certificate expiry (30 days)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>traefik_tls_certs_not_after</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>time</span><span style=color:#ce5c00;font-weight:700>())</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>86400</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=glances>Glances</h2><h3 id=overview-4>Overview</h3><p>Real-time system monitoring with web UI.</p><p><strong>Access:</strong> <a href=https://glances.antoineglacet.com>https://glances.antoineglacet.com</a></p><h3 id=features>Features</h3><ul><li>CPU usage (per core)</li><li>Memory and swap</li><li>Disk I/O</li><li>Network traffic</li><li>Docker container stats</li><li>Process list</li><li>System sensors (temperature)</li><li>File system usage</li></ul><h3 id=configuration-1>Configuration</h3><p><strong>Auto-refresh:</strong> 2 seconds (default)</p><p><strong>Disable update check:</strong> <code>GLANCES_OPT=-w --disable-check-update</code></p><h3 id=api-access>API Access</h3><p>Glances exposes REST API:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Get system stats</span>
</span></span><span style=display:flex><span>curl http://glances:61208/api/3/all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># CPU info</span>
</span></span><span style=display:flex><span>curl http://glances:61208/api/3/cpu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Memory info</span>
</span></span><span style=display:flex><span>curl http://glances:61208/api/3/mem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Docker containers</span>
</span></span><span style=display:flex><span>curl http://glances:61208/api/3/docker
</span></span></code></pre></div><h3 id=useful-views>Useful Views</h3><ul><li><strong>Per-process:</strong> Click on process name</li><li><strong>Disk I/O:</strong> Shows read/write rates</li><li><strong>Network:</strong> In/out bandwidth</li><li><strong>Alerts:</strong> Red highlights for thresholds</li></ul><h2 id=best-practices>Best Practices</h2><h3 id=monitoring>Monitoring</h3><ol><li><strong>Check dashboards daily</strong> - Quick health overview</li><li><strong>Set up alerts</strong> - Get notified of issues</li><li><strong>Review logs weekly</strong> - Catch patterns early</li><li><strong>Monitor trends</strong> - Identify capacity needs</li></ol><h3 id=performance>Performance</h3><ol><li><strong>Tune scrape intervals</strong> - Balance freshness vs load</li><li><strong>Set retention policies</strong> - Don&rsquo;t store forever</li><li><strong>Add resource limits</strong> - Prevent resource hogging</li><li><strong>Clean up old data</strong> - Reclaim disk space</li></ol><h3 id=alerting-1>Alerting</h3><ol><li><strong>Start conservative</strong> - Add alerts gradually</li><li><strong>Tune thresholds</strong> - Avoid alert fatigue</li><li><strong>Test notifications</strong> - Ensure Discord works</li><li><strong>Document response</strong> - How to fix each alert</li></ol></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Homepage aria-label=Homepage><a target=_blank rel=noopener href=https://homepage.antoineglacet.com aria-label=Homepage><i class="fa fa-home"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Antoine Glacet</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.258190f24d50bde9095e369c0cd7315407f95e1da5f39472b3850b40279a9e08.js integrity="sha256-JYGQ8k1QvekJXjacDNcxVAf5Xh2l85Rys4ULQCeangg=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>